---
layout: default
title: コマンド関連
permalink: /command/
---

<p>コマンド関連のスレッドにようこそ！</p>

<section class="thread-section">
  <h2 class="thread-section-title">スレッド一覧</h2>
  <div class="thread-list">
    <a href="{{ '/command/heya1/' | relative_url }}" class="thread-btn" data-room="heya1">
      部屋1 <span class="count">(0)</span>
    </a>
    <a href="{{ '/command/heya2/' | relative_url }}" class="thread-btn" data-room="heya2">
      部屋2 <span class="count">(0)</span>
    </a>
  </div>
</section>

<script type="module">
  import { app } from '../auth.js';
  import { getDatabase, ref as dbRef, get } from 'https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js';

  async function updateCounts() {
    const db = getDatabase(app);
    document.querySelectorAll('.thread-btn').forEach(async btn => {
      const room = btn.dataset.room;  // data-room 属性からルームIDを取得
      const snap = await get(dbRef(db, `rooms/${room}/messages`));
      const data = snap.val() || {};
      const count = Object.keys(data).length;
      btn.querySelector('.count').textContent = `(${count})`;
    });
  }

  updateCounts();
</script>

<style>
  .thread-list .thread-btn {
    text-decoration: none;
    color: inherit;
  }
</style>
