---
layout: default
title: コマンド関連
permalink: /command/
---

<p>コマンド関連のスレッドにようこそ！</p>

<section class="thread-section">
  <h2 class="thread-section-title">スレッド一覧</h2>
  <div class="thread-list">
    <a href="{{ '/command/heya1/' | relative_url }}"
       class="thread-btn"
       data-room="command/heya1">
      部屋1 <span class="count">(0)</span>
    </a>
    <a href="{{ '/command/heya2/' | relative_url }}"
       class="thread-btn"
       data-room="command/heya2">
      部屋2 <span class="count">(0)</span>
    </a>
  </div>
</section>

<script type="module">
  import { app } from '../auth.js';
  import {
    getDatabase,
    ref as dbRef,
    onValue
  } from 'https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js';

  const db = getDatabase(app);

  document.querySelectorAll('.thread-btn').forEach(btn => {
    // data-room 属性に rooms 配下のパスを入れておく
    const path = btn.dataset.room;            // "command/heya1" など
    const countEl = btn.querySelector('.count');
    const msgsRef = dbRef(db, `rooms/${path}/messages`);

    // リアルタイムでメッセージ数をカウント
    onValue(msgsRef, snap => {
      const data = snap.val() || {};
      const cnt  = Object.keys(data).length;
      countEl.textContent = `(${cnt})`;
    });
  });
</script>

<style>
  .thread-list .thread-btn {
    text-decoration: none;
    color: inherit;
  }
</style>
